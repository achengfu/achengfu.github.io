<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>下班倒计时</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <link href="https://cdn.bootcss.com/minireset.css/0.0.2/minireset.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/localStorage/2.0.1/localStorage.min.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>
    <style>
        h1{
            text-align: center;
            align-items: center;
            font-size:10vw;
        }
        button{
            background-color: #7B72E9;
            border-color: #7B72E9;
            color:#fff;
            margin:5px;
        }
    </style>
</head>

<body>
    <div id="app">
        <h1>
            <button @click="setTime">重设时间</button>
            <div v-show="!expired">
            <h1>下班倒计时</h1>
            <h1>{{theTime.hours}}时{{theTime.minutes}}分{{theTime.seconds}}秒</h1>
            </div>
        </h1>
        <h1 v-if="expired">{{endText}}</h1>
    </div>
    <script>
        new Vue({
            el: "#app",
            data: {
                hours: "",
                minutes: "",
                seconds: "",
                endTime: "2018/05/31 19:00:00",
                endText: "“下什么班，单身狗，加班吧”",
                hourtime:"19:00:00",
                prevtime:"19:00:00",
                expired: false
            },
            computed: {
                theTime() {
                    var ctx = this,
                        countDownDate = new Date(ctx.endTime).getTime();
                    var x = setInterval(function () {
                        var countDownDate = new Date(ctx.endTime).getTime(),
                            now = new Date().getTime(),
                            diff = countDownDate - now,
                            tdays = Math.floor(diff / (1000 * 60 * 60 * 24)),
                            thours = Math.floor(
                                (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
                            ),
                            tminutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)),
                            tseconds = Math.floor((diff % (1000 * 60)) / 1000);
                        ctx.days = tdays < 10 ? "0" + tdays : tdays;
                        ctx.hours = thours < 10 ? "0" + thours : thours;
                        ctx.minutes = tminutes < 10 ? "0" + tminutes : tminutes;
                        ctx.seconds = tseconds < 10 ? "0" + tseconds : tseconds;
                        if (diff < 0) {
                            clearInterval(x);
                            ctx.expired = true;
                        }else{
                            ctx.expired = false
                        }
                    }, 1000);
                    return {
                        days: ctx.days,
                        hours: ctx.hours,
                        minutes: ctx.minutes,
                        seconds: ctx.seconds
                    };
                }
            },
            methods:{
                setTime(){
                    this.hourtime = prompt("输入下班时间，如下： ", this.prevtime);
                    if(this.hourtime===null){
                        alert("不能为空");
                        this.setTime()
                    }else{
                        this.prevtime = this.hourtime;
                        window.localStorage.setItem("xbTime",this.hourtime);
                        this.endTime = new Date().toLocaleDateString() + " " + this.hourtime;
                    }
                }
            },
            beforeMount() {
                if (window.localStorage.getItem("xbTime") && window.localStorage.getItem("xbTime")!=null) {
                    this.endTime = new Date().toLocaleDateString() + " " + window.localStorage.getItem("xbTime");
                } else {
                    this.hourtime = prompt("输入下班时间，如下： ", "19:00:00");
                    if(this.hourtime===null){
                        alert("不能为空");
                        this.setTime()
                    }
                    this.prevtime = this.hourtime;
                    window.localStorage.setItem("xbTime",this.hourtime);
                    this.endTime = new Date().toLocaleDateString() + " " + this.hourtime;
                }
            }
        });
    </script>
</body>

</html>
